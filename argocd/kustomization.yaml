apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd
resources:
  - namespace.yaml
  # v1.7.0
  - github.com/argoproj/argo-cd/manifests/cluster-install?ref=24b93197e05d02e31f6b788e53b529cadcf2ccd4
  - ingress.yaml
  - argo-cd-service-monitor.yaml
  - argocd-notifications/
  # Projects
  - projects/default.yaml
  # Applications to deploy
  - applications/argocd.yaml
  - applications/book.yaml
  - applications/cert-manager.yaml
  - applications/cert-manager-issuers.yaml
  - applications/external-dns.yaml
  - applications/ingress-nginx.yaml
  - applications/ircd.yaml
  - applications/monitoring.yaml
  - applications/mtls.yaml
  - applications/site.yaml
  - applications/userdb-api.yaml
  - applications/webirc.yaml
patches:
  - argo-cd-repo-server-ksops.patch.yaml
  - argo-cd-allow-alpha-plugins.patch.yaml
  - argo-cd-import-pgp-key.patch.yaml
  - argo-cd-repository-credentials.patch.yaml
  - argo-cd-rbac.patch.yaml
  - argo-cd-allow-status-badges.patch.yaml
  - users.patch.yaml
configMapGenerator:
  - name: grafana-dashboard
    options:
      disableNameSuffixHash: true
      labels:
        grafana_dashboard: "1"
    files:
      # From https://github.com/argoproj/argo-cd/blob/master/examples/dashboard.json
      - files/grafana-dashboard-argocd.json
      # From https://argoproj-labs.github.io/argocd-notifications/grafana-dashboard.json
      - files/grafana-dashboard-argocd-notifications.json
images:
  - name: argoproj/argocd:v1.7.0
    digest: sha256:72c41fa57726155a6827d37f19cb107353d181ca9a12eb9825093e65c1ba1879
  - name: quay.io/dexidp/dex:v2.22.0
    digest: sha256:01e996b4b60edcc5cc042227c6965dd63ba68764c25d86b481b0d65f6e4da308
  - name: redis:5.0.8
    digest: sha256:de935cb5eb1d96a5b75c871cd408a728b89d100712ae4599eb994bb7a41a9336
  - name: viaductoss/ksops:v2.1.2-go-1.14
    digest: sha256:2bc2461e2a62139f29a5a8a01e1ff20c0277a3fdb3e5384381d8481e2fdedd30
generators:
  - secret-generator.yaml
replicas:
- name: argocd-server
  count: 3
